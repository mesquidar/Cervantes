@using System.Globalization
@model ReportViewModel

@{
    Layout = null;
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta name="author" content="{{ org.name }}"/>
    <script src="/lib/chartjs/chart.min.js"></script>
    <title></title>
    <style>
        body {
            margin-top: 25.4mm;
            margin-left: 31.7mm;
            margin-right: 31.7mm;
            font-size: 11pt;
              -webkit-print-color-adjust:exact;
        }
        a {
            color: #748094;
        }
        * {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        }
        h2 {
            margin-top: 1cm;
            border-bottom: 1px solid #748094;
            padding-bottom: .25cm;
        }
        dt {
            font-weight: bold;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            border-radius: 3px;
        }
        table th {
            padding: 8px;
        }
        tr td:first-child {
            font-weight: bold;
            width: 300px;
        }
        td {
            padding: 8px;
            border: 1px solid #c3c3c3;
        }
        td.risk-low {
            background-color: #579F6E;
            color: white;
        }
        td.risk-medium {
            background-color: #FFFC84;
            color: #2E2D22;
        }
        td.risk-high {
            background-color: #FEC022;
            color: white;
        }
        td.risk-critical {
            background-color: #E56E6A;
            color: white;
        }
        .new-page-separator {
            page-break-before: always;
        }


    </style>
</head>

<body>

    <div align="center" >

        <img src="~/img/logo_black.png" heigt="300" width="300"/>
        <h1>Test Company</h1>
    </div>
    <br /><br />

        <div align="center" >
           <h1>@Model.Project.Name</h1>
           <p>Prepared by @Model.Organization.Name</p>
            <h3>Prepared for: @Model.Project.Client.Name</h3>
            <p>Start Date: @Model.Project.StartDate.DayOfWeek @Model.Project.StartDate.Day @CultureInfo.CurrentCulture.DateTimeFormat.GetMonthName(Model.Project.StartDate.Month) @Model.Project.StartDate.Year </p>
            <p>End Date: @Model.Project.EndDate.DayOfWeek @Model.Project.EndDate.Day @CultureInfo.CurrentCulture.DateTimeFormat.GetMonthName(Model.Project.EndDate.Month) @Model.Project.EndDate.Year</p>
    </div>
      <br /><br />
          <div align="center" >
           <img src="@Url.Content(Model.Project.Client.ImagePath)" height="150" width="150"/>
           <h1>@Model.Project.Client.Name</h1>
    </div>

<div style="break-after:page;page-break-after: always;"></div>
        <div align="right" >
           <h4>@Model.Organization.Name</h4>
           <p>@Model.Organization.ContactEmail</p>
           <p>@Model.Organization.ContactPhone</p>
           <br />
           <h4>@Model.Project.Client.Name</h4>
           <p>@Model.Project.Client.ContactEmail</p>
           <p>@Model.Project.Client.ContactPhone</p>
    </div>
<br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
<p>
No warranties, express or implied are given by @Model.Organization.Name with respect to accuracy, reliability, 
quality, correctness, or freedom from error or omission of this work product, including any implied 
warranties of merchantability, fitness for a specific purpose or non-infringement. This document is 
delivered "as is", and @Model.Organization.Name shall not be liable for any inaccuracy thereof. @Model.Organization.Name does 
not warrant that all errors in this work product shall be corrected. Except as expressly set forth in any 
master services agreement or project assignment, @Model.Organization.Name is not assuming any obligations or 
liabilities including but not limited to direct, indirect, incidental or consequential, special or exemplary 
damages resulting from the use of or reliance upon any information in this document. This document 
does not imply an endorsement of any of the companies or products mentioned.
</p>
<p>
©@DateTime.Today.Year @Model.Organization.Name. All rights reserved. No part of this document may be reproduced, copied or 
modified without the express written consent of the authors. Unless written permission is expressly 
granted for other purposes, this document shall be treated at all times as the confidential and proprietary 
material of PrimoConnect and may not be distributed or published to any third-party.
</p>
    <div style="break-after:page;page-break-after: always;"></div>


    <div style="break-after:page;page-break-after: always;"></div>

    <h1>Version control</h1>

    <table>
        <thead>
        <tr>
            <th>Date/Time</th>
            <th>Version</th>
            <th>Description</th>
        </tr>
        </thead>
        <tbody>
            @if (Model.Reports != null)
            {
                @foreach (var rep in Model.Reports)
                {
                    <tr>
                        <td>@rep.CreatedDate.DayOfWeek @rep.CreatedDate.Day @CultureInfo.CurrentCulture.DateTimeFormat.GetMonthName(@rep.CreatedDate.Month) @rep.CreatedDate.Year</td>
                        <td>@rep.Version</td>
                        <td>@rep.Description</td>
                   </tr>
                }
            }
           
 
        </tbody>
    </table>



<div style="break-after:page;page-break-after: always;"></div>


    <h1><a id="pentesting-team">Pentesting team</a></h1>
    @if (Model.Users != null) {

        <table>
            <thead>
        <tr>
            <th></th>
            <th>Name</th>
            <th>Email</th>
            <th>Position</th>
        </tr>
        </thead>
            <tbody>
                @foreach(var user in Model.Users){
                <tr>
                    <td style=" width: 60px; padding-bottom: 8px;">
                        <img alt="Avatar" style="width: 50px;"
                         src="https://www.gravatar.com/avatar/{{ user.email_md5 }}?s=200&d=robohash"/>
                    </td>
                    <td>
                        <h3>@user.User.FullName</h3>
                        
                        
                    </td>
                    <td><p>@user.User.Email</p></td>
                    <td><p>@user.User.Position</p></td>
                </tr>
                }
            </tbody>
        </table>
    }

    <div style="break-after:page;page-break-after: always;"></div>

    <h1><a id="pentesting-team">Introduction</a></h1>



    @if (Model.Targets != null)
    {

        <div style="break-after:page;page-break-after: always;"></div>

        <h1><a id="targets">Targets</a></h1>

            @foreach (var target in Model.Targets)
            {
            <table>
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Type</th>
                </tr>
            </thead>
            <tbody>
                     
                <tr>
                    <td>@target.Name</td>
                    <td>@target.Type</td>
                </tr>
            </tbody>
        </table>

            }

    }

<div style="break-after:page;page-break-after: always;"></div>


        <h1><a id="findings-overview">Findings overview</a></h1>
        <p>The following sections list both vulnerabilities and implementation issues spotted during
            the testing period. Note that findings are listed  by
            their degree of severity and impact. The aforementioned severity rank is simply given in
            brackets following the title heading for each vulnerability</p>
            <br /><br />
        <table>
            <thead>
                <tr>
                    <th>Severity</th>
                    <th>Count</th>
                </tr>
            </thead>
            <tbody>
              
                    
                
                <tr>
                    <td style="background-color:#dc3545">Critical</td>
                    <td>@Model.Vulns.Where(x => x.Risk == Cervantes.CORE.VulnRisk.Critical).Count()</td>
                </tr>
                <tr>
                    <td style="background-color:#fd7e14">High</td>
                    <td>@Model.Vulns.Where(x => x.Risk == Cervantes.CORE.VulnRisk.High).Count()</td>
                </tr>
                <tr>
                    <td style="background-color:#ffc107">Medium</td>
                    <td>@Model.Vulns.Where(x => x.Risk == Cervantes.CORE.VulnRisk.Medium).Count()</td>
                </tr>
                <tr>
                    <td style="background-color:#28a745">Low</td>
                    <td>@Model.Vulns.Where(x => x.Risk == Cervantes.CORE.VulnRisk.Low).Count()</td>
                </tr>
                <tr>
                    <td style="background-color:#007bff">Info</td>
                    <td>@Model.Vulns.Where(x => x.Risk == Cervantes.CORE.VulnRisk.Info).Count()</td>
                </tr>
            </tbody>
        </table>

        <br /><br /><br />
        <table>
            <tbody>
            @foreach (var critical in Model.Vulns.Where(x => x.Risk == Cervantes.CORE.VulnRisk.Critical))
            {
                <tr>                 
                    <td colspan="2" align="center" style="background-color:#dc3545; color:white">@critical.Name - @critical.cve</td>
                </tr>
                <tr>
                        <td colspan="2">@critical.VulnCategory.Name</td>
                </tr>
            }
             @foreach (var high in Model.Vulns.Where(x => x.Risk == Cervantes.CORE.VulnRisk.High))
            {
                <tr>                 
                    <td colspan="2" align="center" style="background-color:#fd7e14; color:white">@high.Name - @high.cve</td>
                </tr>
                <tr>
                        <td colspan="2">@high.VulnCategory.Name</td>
                </tr>
            }
            @foreach (var medium in Model.Vulns.Where(x => x.Risk == Cervantes.CORE.VulnRisk.Medium))
            {
                <tr>                 
                    <td colspan="2" align="center" style="background-color:#ffc107; color:white">@medium.Name - @medium.cve</td>
                </tr>
                <tr>
                        <td colspan="2">@medium.VulnCategory.Name</td>
                </tr>
            }
            @foreach (var low in Model.Vulns.Where(x => x.Risk == Cervantes.CORE.VulnRisk.Low))
            {
                <tr>                 
                    <td colspan="2" align="center" style="background-color:#28a745; color:white">@low.Name - @low.cve</td>
                </tr>
                <tr>
                        <td colspan="2">@low.VulnCategory.Name</td>
                </tr>
            }
             @foreach (var info in Model.Vulns.Where(x => x.Risk == Cervantes.CORE.VulnRisk.Info))
            {
                <tr>                 
                    <td colspan="2" align="center" style="background-color:#007bff; color:white">@info.Name - @info.cve</td>
                </tr>
                <tr>
                        <td colspan="2">@info.VulnCategory.Name</td>
                </tr>
            }
            </tbody>
        </table>



<div style="break-after:page;page-break-after: always;"></div>

<h1><a id="findings-overview">Findings Classification</a></h1>
<p>Each vulnerability or risk identified has been labeled as a finding and categorized as a Critical, High, Medium, Low or Informational Risk which ar defined as:</p>

<h2>Critical</h2>
<p>These vulnerabilities should be addressed promptly as they may pose an immediate danger to the security of the networks, systems or data.</p>
<p>Exploitation does not require advanced tools or techniques or special knowledge of the target.</p>

<h2>High</h2>
<p>These vulnerabilities should be addressed promptly as they may pose an immediate danger to the security of the networks, systems or data.</p>
<p>The issue is commonly more difficult to exploit but could allow for elevated permissions, loss of data, or a system downtime.</p>

<h2>Medium</h2>
<p>These vulnerabilities should be addressed promptly in a timely manner.</p>
<p>Exploitation is often difficult to exploit and requires social engineering, existing access, or  special circumstances.</p>

<h2>Low</h2>
<p>The vulnerabilities should be noted and addressed at a later date.</p>
<p>These issues offer very little oportunity or information to an attacker and may not pose an actual threat.</p>


<h2>Info</h2>
<p>These issues are for informational purposes oly and likely do not represent actual threat.</p>

<div style="break-after:page;page-break-after: always;"></div>

<h1><a id="vulns">Vulnerabilities</a></h1>
@if(Model.Vulns.Where(x => x.Risk == Cervantes.CORE.VulnRisk.Critical).Count() != 0){
<h2>Critical Risk Findings</h2>

        @foreach (var vuln in Model.Vulns.Where(x => x.Risk == Cervantes.CORE.VulnRisk.Critical))
        {

            <div>

                <h3>@vuln.Name - @vuln.cve</h3>

                <table>
                    <tbody>

                        <tr>
                            <td style="background-color:#6c757d; color:white">Category</td>
                            <td>@vuln.VulnCategory.Name</td>
                        </tr>

                        <tr>
                            <td style="background-color:#6c757d; color:white">Risk</td>
                            <td>@vuln.Risk</td>
                        </tr>

                        <tr>
                            <td style="background-color:#6c757d; color:white">CVSS3 Score</td>
                            <td><a href="https://www.first.org/cvss/calculator/3.0#@vuln.CVSSVector">@vuln.CVSS3</a></td>
                        </tr>
                        <tr>

                            <td colspan="2" align="center" style="background-color:#6c757d; color:white">Description</td>
                        </tr>
                        <tr>
                            <td colspan="2">@vuln.Description</td>
                        </tr>
                        <tr>                 
                            <td colspan="2" align="center" style="background-color:#6c757d; color:white">Impact</td>
                        </tr>
                        <tr>
                            <td colspan="2">@vuln.Impact</td>
                        </tr>
                        <tr>                 
                            <td colspan="2" align="center" style="background-color:#6c757d; color:white">Proof of concept</td>
                        </tr>
                        <tr>
                            <td colspan="2">@vuln.ProofOfConcept</td>
                        </tr>
                        <tr>                 
                            <td colspan="2" align="center" style="background-color:#6c757d; color:white">Remediation</td>
                        </tr>
                        <tr>
                            <td colspan="2">@vuln.Remediation</td>
                        </tr>
                    </tbody>
                </table>

            </div>
        }
    }

        @if(Model.Vulns.Where(x => x.Risk == Cervantes.CORE.VulnRisk.High).Count() != 0){
        <h2>High Risk Findings</h2>
        @foreach (var vuln in Model.Vulns.Where(x => x.Risk == Cervantes.CORE.VulnRisk.High))
        {

            <div>

                <h2>@vuln.Name - @vuln.cve</h2>

                <table>
                    <tbody>

                        <tr>
                            <td style="background-color:#6c757d; color:white">Category</td>
                            <td>@vuln.VulnCategory.Name</td>
                        </tr>

                        <tr>
                            <td style="background-color:#6c757d; color:white">Risk</td>
                            <td>@vuln.Risk</td>
                        </tr>

                        <tr>
                            <td style="background-color:#6c757d; color:white">CVSS3 Score</td>
                            <td><a href="https://www.first.org/cvss/calculator/3.0#@vuln.CVSSVector">@vuln.CVSS3</a></td>
                        </tr>
                        <tr>

                            <td colspan="2" align="center" style="background-color:#6c757d; color:white">Description</td>
                        </tr>
                        <tr>
                            <td colspan="2">@vuln.Description</td>
                        </tr>
                        <tr>                 
                            <td colspan="2" align="center" style="background-color:#6c757d; color:white">Impact</td>
                        </tr>
                        <tr>
                            <td colspan="2">@vuln.Impact</td>
                        </tr>
                        <tr>                 
                            <td colspan="2" align="center" style="background-color:#6c757d; color:white">Proof of concept</td>
                        </tr>
                        <tr>
                            <td colspan="2">@vuln.ProofOfConcept</td>
                        </tr>
                        <tr>                 
                            <td colspan="2" align="center" style="background-color:#6c757d; color:white">Remediation</td>
                        </tr>
                        <tr>
                            <td colspan="2">@vuln.Remediation</td>
                        </tr>
                    </tbody>
                </table>

            </div>
        }
    }

        @if(Model.Vulns.Where(x => x.Risk == Cervantes.CORE.VulnRisk.Medium).Count() != 0){
        <h2>Medium Risk Findings</h2>

        @foreach (var vuln in Model.Vulns.Where(x => x.Risk == Cervantes.CORE.VulnRisk.Medium))
        {

            <div>

                <h3>@vuln.Name - @vuln.cve</h3>

                <table>
                    <tbody>

                        <tr>
                            <td style="background-color:#6c757d; color:white">Category</td>
                            <td>@vuln.VulnCategory.Name</td>
                        </tr>

                        <tr>
                            <td style="background-color:#6c757d; color:white">Risk</td>
                            <td>@vuln.Risk</td>
                        </tr>

                        <tr>
                            <td style="background-color:#6c757d; color:white">CVSS3 Score</td>
                            <td><a href="https://www.first.org/cvss/calculator/3.0#@vuln.CVSSVector">@vuln.CVSS3</a></td>
                        </tr>
                        <tr>

                            <td colspan="2" align="center" style="background-color:#6c757d; color:white">Description</td>
                        </tr>
                        <tr>
                            <td colspan="2">@vuln.Description</td>
                        </tr>
                        <tr>                 
                            <td colspan="2" align="center" style="background-color:#6c757d; color:white">Impact</td>
                        </tr>
                        <tr>
                            <td colspan="2">@vuln.Impact</td>
                        </tr>
                        <tr>                 
                            <td colspan="2" align="center" style="background-color:#6c757d; color:white">Proof of concept</td>
                        </tr>
                        <tr>
                            <td colspan="2">@vuln.ProofOfConcept</td>
                        </tr>
                        <tr>                 
                            <td colspan="2" align="center" style="background-color:#6c757d; color:white">Remediation</td>
                        </tr>
                        <tr>
                            <td colspan="2">@vuln.Remediation</td>
                        </tr>
                    </tbody>
                </table>

            </div>
        }
    }

        @if(Model.Vulns.Where(x => x.Risk == Cervantes.CORE.VulnRisk.Low).Count() != 0){
        <h2>Low Risk Findings</h2>

        @foreach (var vuln in Model.Vulns.Where(x => x.Risk == Cervantes.CORE.VulnRisk.Low))
        {

            <div>

                <h3>@vuln.Name - @vuln.cve</h3>

                <table>
                    <tbody>

                        <tr>
                            <td style="background-color:#6c757d; color:white">Category</td>
                            <td>@vuln.VulnCategory.Name</td>
                        </tr>

                        <tr>
                            <td style="background-color:#6c757d; color:white">Risk</td>
                            <td>@vuln.Risk</td>
                        </tr>

                        <tr>
                            <td style="background-color:#6c757d; color:white">CVSS3 Score</td>
                            <td><a href="https://www.first.org/cvss/calculator/3.0#@vuln.CVSSVector">@vuln.CVSS3</a></td>
                        </tr>
                        <tr>

                            <td colspan="2" align="center" style="background-color:#6c757d; color:white">Description</td>
                        </tr>
                        <tr>
                            <td colspan="2">@vuln.Description</td>
                        </tr>
                        <tr>                 
                            <td colspan="2" align="center" style="background-color:#6c757d; color:white">Impact</td>
                        </tr>
                        <tr>
                            <td colspan="2">@vuln.Impact</td>
                        </tr>
                        <tr>                 
                            <td colspan="2" align="center" style="background-color:#6c757d; color:white">Proof of concept</td>
                        </tr>
                        <tr>
                            <td colspan="2">@vuln.ProofOfConcept</td>
                        </tr>
                        <tr>                 
                            <td colspan="2" align="center" style="background-color:#6c757d; color:white">Remediation</td>
                        </tr>
                        <tr>
                            <td colspan="2">@vuln.Remediation</td>
                        </tr>
                    </tbody>
                </table>

            </div>
        }
    }

        @if(Model.Vulns.Where(x => x.Risk == Cervantes.CORE.VulnRisk.Info).Count() != 0){
        <h2>Informational Risk Findings</h2>

         @foreach (var vuln in Model.Vulns.Where(x => x.Risk == Cervantes.CORE.VulnRisk.Info))
        {

            <div>
               
            <h3>@vuln.Name - @vuln.cve</h3>

            <table>
                <tbody>

                    <tr>
                        <td style="background-color:#6c757d; color:white">Category</td>
                        <td>@vuln.VulnCategory.Name</td>
                    </tr>

                    <tr>
                        <td style="background-color:#6c757d; color:white">Risk</td>
                        <td>@vuln.Risk</td>
                    </tr>

                    <tr>
                        <td style="background-color:#6c757d; color:white">CVSS3 Score</td>
                        <td><a href="https://www.first.org/cvss/calculator/3.0#@vuln.CVSSVector">@vuln.CVSS3</a></td>
                    </tr>
                    <tr>
                    
                        <td colspan="2" align="center" style="background-color:#6c757d; color:white">Description</td>
                    </tr>
                    <tr>
                        <td colspan="2">@vuln.Description</td>
                    </tr>
                     <tr>                 
                        <td colspan="2" align="center" style="background-color:#6c757d; color:white">Impact</td>
                    </tr>
                    <tr>
                        <td colspan="2">@vuln.Impact</td>
                    </tr>
                    <tr>                 
                        <td colspan="2" align="center" style="background-color:#6c757d; color:white">Proof of concept</td>
                    </tr>
                    <tr>
                        <td colspan="2">@vuln.ProofOfConcept</td>
                    </tr>
                     <tr>                 
                        <td colspan="2" align="center" style="background-color:#6c757d; color:white">Remediation</td>
                    </tr>
                    <tr>
                        <td colspan="2">@vuln.Remediation</td>
                    </tr>
                </tbody>
            </table>

        </div>
        }
        }
    




</body>
</html>